<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat List</title>
</head>
<body>
<h1>Chat Rooms</h1>

<!-- 방 생성 폼 -->
<form id="createRoomForm">
    <input type="text" id="roomName" placeholder="채팅방 이름" required>
    <button type="submit">방 만들기</button>
</form>

<!-- 방 목록 -->
<table>
    <thead>
    <tr>
        <th>방 이름</th>
    </tr>
    </thead>
    <tbody id="roomList">
    <!-- 방 목록이 여기에 추가됩니다 -->
    </tbody>
</table>

<script>
    // DOMContentLoaded 이벤트로 JS 초기화
    document.addEventListener('DOMContentLoaded', function () {
        const roomListTable = document.getElementById('roomList');
        const createRoomForm = document.getElementById('createRoomForm');

        // 채팅방 목록 가져오기
        function loadRoomList() {
            fetch('/chat/chatList')
                .then(response => response.json())
                .then(data => {
                    roomListTable.innerHTML = ''; // 기존 내용을 초기화
                    data.forEach(room => {
                        const row = document.createElement('tr');
                        const cell = document.createElement('td');
                        const link = document.createElement('a');
                        link.href = `/chat/chatRoom?roomId=${room.roomId}`;
                        link.textContent = room.name;
                        cell.appendChild(link);
                        row.appendChild(cell);
                        roomListTable.appendChild(row);
                    });
                })
                .catch(error => console.error('Error fetching room list:', error));
        }

        // 방 생성 요청 처리
        createRoomForm.addEventListener('submit', function (event) {
            event.preventDefault(); // 기본 폼 제출 동작 방지
            const roomName = document.getElementById('roomName').value;
            fetch('/chat/createRoom', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `name=${encodeURIComponent(roomName)}`,
            })
                .then(response => response.json())
                .then(room => {
                    alert(`"${room.name}" 방이 생성되었습니다!`);
                    loadRoomList(); // 방 목록 새로고침
                })
                .catch(error => console.error('Error creating room:', error));
        });

        // 초기 방 목록 로드
        loadRoomList();
    });
</script>
</body>
</html>
